<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="John Doe">





<title>服务端开发 | Hexo</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Bentham&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Bentham&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">服务端开发</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">John Doe</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">September 7, 2023&nbsp;&nbsp;18:41:06</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记</a>
                            
                                <a href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/">服务端开发</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="服务端开发"><a href="#服务端开发" class="headerlink" title="服务端开发"></a>服务端开发</h1><h2 id="Spring-boot-开发框架"><a href="#Spring-boot-开发框架" class="headerlink" title="Spring boot 开发框架"></a>Spring boot 开发框架</h2><ol>
<li>可以创建独立的Spring应用程序，并且基于其Maven或Gradle插件，可以创建可执行的JARs和WARs（不需要其他依赖直接就能跑）</li>
<li>内嵌Tomcat或Jetty等Serverlet容器（Web容器）</li>
<li>提供自动配置的starter项目对象模型以简化Maven配置（依赖集成）</li>
<li>尽可能自动配置Spring容器</li>
<li>提供准备好的特性</li>
<li>绝对没有代码生成</li>
</ol>
<h4 id="ObjectBeanComponent"><a href="#ObjectBeanComponent" class="headerlink" title="ObjectBeanComponent"></a>Object<del>Bean</del>Component</h4><p>Component更加面向业务</p>
<p>Bean更加抽象一点，是spring管理的一个基本单元</p>
<p>object面向对象语言中的对象</p>
<h4 id="Jar-和-War-的区别"><a href="#Jar-和-War-的区别" class="headerlink" title="Jar 和 War 的区别"></a>Jar 和 War 的区别</h4><p>Jar比较大，因为它能直接跑，War里面没有Tomcat，不能直接跑</p>
<p>Thymeleaf 模版解析器，用于生成动态的HTML页面</p>
<p>没有特别指定的版本号都用parent里面对应的版本号</p>
<h4 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h4><p>这个注解至少包括了三个注解类：</p>
<p>@<strong>SpringBootConfiguration</strong></p>
<p>@<strong>EnableAutoConfiguration</strong></p>
<p>@<strong>ComponentScan</strong>：Spring boot按照参数中给出的路径，针对特定的type，扫描类定义，在看到@Component注解时进行实例化</p>
<h3 id="开发框架的分层"><a href="#开发框架的分层" class="headerlink" title="开发框架的分层"></a>开发框架的分层</h3><h3 id="Spring的衍生"><a href="#Spring的衍生" class="headerlink" title="Spring的衍生"></a>Spring的衍生</h3><p>Springboot</p>
<p>springcloud</p>
<h3 id="Junit测试用例"><a href="#Junit测试用例" class="headerlink" title="Junit测试用例"></a>Junit测试用例</h3><ul>
<li>使用@Test</li>
<li>使用void进行修饰</li>
<li>assert，对预期结果的断定</li>
</ul>
<h3 id="开发期工具：Spring-boot-DevTools"><a href="#开发期工具：Spring-boot-DevTools" class="headerlink" title="开发期工具：Spring boot DevTools"></a>开发期工具：Spring boot DevTools</h3><h2 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h2><h4 id="Bean的生命周期"><a href="#Bean的生命周期" class="headerlink" title="Bean的生命周期"></a>Bean的生命周期</h4><h4 id="应用上下文"><a href="#应用上下文" class="headerlink" title="应用上下文"></a>应用上下文</h4><ul>
<li>AnnotationConfigApplicationContext</li>
<li>AnnotationConfigWebApplicationContext</li>
<li>ClassPathXmlApplicationContext（基于xml文件建立的应用上下文）</li>
</ul>
<h4 id="注解配置-Recommended"><a href="#注解配置-Recommended" class="headerlink" title="注解配置(Recommended)"></a>注解配置(Recommended)</h4><p>@Component但是有的类需要初始化属性，所以可以使用@Autowired(命令spring去上下文中寻找符合类型要求的对象，如果找到了并且只找到一个，那么直接注入，没找到直接失败，如果找到了多个对象也会报错 可以使用@Primary让Spring优先注入某类实例，也可以通过@Qualifier(cd【Bean的id】，这个id默认是当前类的名字，也可以通过@Component(Bean的id)来指定)来要求spring只寻找cd来注入) 这个注解可以加到属性上，也可以加到构造函数上</p>
<p>配置类</p>
<p>@Configuration 说明这是一个配置类</p>
<p>@ComponentScan 命令Spring去扫描当前类所在的包及自报加了@Component注解的类并实例化，也可以使用@ComponentScan(basePackages &#x3D; {“soudsystem”,”abc”,…})指定想扫描的包路径（这是类型不安全的，因为都是字符串）或是@ComponentScan(basePackageClasses&#x3D;CDplayer.class)让spring去指定的类所在的包下去搜索（这是类型安全的，但是面对代码重构是error pone的，为了处理，我们可以干脆在要指定的包下建立一个空接口）</p>
<p>通过注解配置建立上下文</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContent</span>(CDplayerConfig.class);</span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">player</span> <span class="operator">=</span> ctx.getBean(Mediaplayer.class);</span><br><span class="line">player.play();</span><br></pre></td></tr></table></figure></div>

<p>在测试中使用</p>
<p>@ContextConfiguration(classes &#x3D; CDplayerConfig)</p>
<p>System.getProperty(“line.separator”)可以获得当前系统的换行符</p>
<h4 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h4><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xml:c</span>=<span class="string">&quot;spring/schema/c&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span> =<span class="string">&quot;SoundSystem.Compact&quot;</span> <span class="attr">c:_0</span>=<span class="string">&quot;使用c命名空间为第一个参数指定值&quot;</span> <span class="attr">c:_1-ref</span>=<span class="string">&quot;compactDisc&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cdPlayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;soundsystem.CDPlayer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;compactDisc&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;use value to assgin args&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">consttuctor-arg</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">consttuctor-arg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;compactDisc&quot;</span> <span class="attr">class</span> =<span class="string">&quot;SoundSystem.Compact&quot;</span> <span class="attr">p:compactDisc-ref</span>=<span class="string">&quot;通过p命名空间&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>@ContextCOnfiguration(locations&#x3D;)</p>
<h4 id="javaconfig配置-实例化第三方库的时候用得到"><a href="#javaconfig配置-实例化第三方库的时候用得到" class="headerlink" title="javaconfig配置(实例化第三方库的时候用得到)"></a>javaconfig配置(实例化第三方库的时候用得到)</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CDPlayerConfig</span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> CompactDisc <span class="title function_">compactDisc</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SgtPeppers</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Bean(name = &quot;player1&quot;)</span> <span class="comment">//这玩意儿效果和@Autowired一样</span></span><br><span class="line">  <span class="comment">//当spring发现这里有一个参数时，它会像注解配置那样去找可能的实例</span></span><br><span class="line">  <span class="keyword">public</span> CDplayer <span class="title function_">cdPlayer</span><span class="params">(CompactDisc cd)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CDPlayer</span>(cd);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Bean</span> <span class="comment">// 不指定默认name为方法的名字</span></span><br><span class="line">  <span class="keyword">public</span> CDplayer <span class="title function_">cdPlayer2</span><span class="params">(CompactDisc cd)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CDPlayer</span>(compactDisc());</span><br><span class="line">    <span class="comment">// spring并不会乖乖去调用compactDisc()，当它注意到上文的compactDisc()已经被@Bean实例化，它会拦截后面所有的的compactDisc()，并直接使用上下文中已有的compactDisc()实例填入</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="混合配制"><a href="#混合配制" class="headerlink" title="混合配制"></a>混合配制</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(CDPlayerConfig.class)</span><span class="comment">//这是configuration的根</span></span><br><span class="line"><span class="meta">@ImportResource(一个xml文件)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoundSystemConfig</span>()&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="Bean的生命周期-1"><a href="#Bean的生命周期-1" class="headerlink" title="Bean的生命周期"></a>Bean的生命周期</h3><p>BeanNameAware要实现setBeanName</p>
<p>类似的还有ApplicationContextAware，可以在它的set方法里面获得丰富的信息</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://files.lsmcloud.top/blogfd16269c704e3fd4b9c8b5ff32294864.png"
                     
                ></p>
<h3 id="Java-Faker"><a href="#Java-Faker" class="headerlink" title="Java Faker"></a>Java Faker</h3><p>一个专门构建测试假信息的工具</p>
<h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><h4 id="Profiles"><a href="#Profiles" class="headerlink" title="@Profiles"></a>@Profiles</h4><p>根据指定的profile选择性的创建</p>
<h4 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h4><p>根据条件选择是否创建</p>
<h4 id="ScopedBeans"><a href="#ScopedBeans" class="headerlink" title="@ScopedBeans"></a>@ScopedBeans</h4><p>@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</p>
<p>让spring不再拦截多实例创建</p>
<h4 id="制定作用域"><a href="#制定作用域" class="headerlink" title="制定作用域"></a>制定作用域</h4><p>Session 会话 为每个会话创建一个实例</p>
<p>Request 请求 为每个请求创建一个实例</p>
<h2 id="面向切面的编程"><a href="#面向切面的编程" class="headerlink" title="面向切面的编程"></a>面向切面的编程</h2><h3 id="AOP目标是解决什么问题？"><a href="#AOP目标是解决什么问题？" class="headerlink" title="AOP目标是解决什么问题？"></a>AOP目标是解决什么问题？</h3><ul>
<li>分离横切关注点，将业务代码分离出来，避免对代码的侵入</li>
<li>减少耦合</li>
</ul>
<p>AOP aspect Oreiented Programming</p>
<p>关注点</p>
<ul>
<li>日志</li>
<li>安全</li>
<li>事务</li>
<li>缓存</li>
</ul>
<p>可选</p>
<ul>
<li>继承</li>
<li>委托</li>
</ul>
<p>黑话</p>
<ul>
<li>通知 advice：切面做什么以及何时（方法前？方法后？异常时）</li>
<li>切点pointcut：何处 </li>
<li>切面aspect：通知和切点的结合</li>
<li>连接点join point:所有可以切的点：方法、字段修改、构造方法</li>
<li>引入introduction：引入新的行为和状态，但是不是新建子类，而是动态地新增方法</li>
<li>织入 weaving：将切面应用到目标对象</li>
</ul>
<h3 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h3><ul>
<li>@Before 将逻辑切入到方法调用前</li>
<li>@After …方法执行后</li>
<li>@AfterReturning</li>
<li>@AfterThrowing</li>
<li>@Around 四合一</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Audience</span>&#123;</span><br><span class="line">  <span class="meta">@Before(&quot;execution(* concert.Performance.perform(..))&quot;)</span> <span class="comment">//..意味着参数不限</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">silenceCellPhones</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Silencing cell phone.&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>配置类</p>
<p>@<strong>EnableAspectJAutoProxy</strong></p>
<p>是否允许被切的对象创建代理</p>
<p>同时要实例化切片</p>
<p>可以这样定义一个pointCut来简化切面</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PointCut(&quot;execution(* concert.Performance.perform(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performance</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before(&quot;performance()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">silence</span><span class="params">()</span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>around的使用</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;performance()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">watchPerformance</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;.Silencing cell phones&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;.Taking seats&quot;</span>);</span><br><span class="line">            joinPoint.proceed(); <span class="comment">//around方法有更强的控制能力，比如让方法不被调用，多次被调用</span></span><br><span class="line">            System.out.println(<span class="string">&quot;.CLAP CLAP CLAP!!!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;.Demanding a refund&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;@annotation(appendAnnotation)&quot;)</span> <span class="comment">//括号里是注解类这个参数的名字</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">process</span><span class="params">(ProceedingJoinPoint joinPoint, Append appendAnnotation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> appendAnnotation.word() + <span class="string">&quot; &quot;</span> + joinPoint.proceed() + <span class="string">&quot; &quot;</span> + appendAnnotation.word();</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="切片是如何实现的？"><a href="#切片是如何实现的？" class="headerlink" title="切片是如何实现的？"></a>切片是如何实现的？</h3><p>Spring通过将目标对象和切面一同打包实现一个代理对象，首先处理切面，再处理目标对象</p>
<h3 id="AspectJ-切点指示器"><a href="#AspectJ-切点指示器" class="headerlink" title="AspectJ 切点指示器"></a>AspectJ 切点指示器</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* soundsystem.CompactDisc.playTrack(int))&quot;+&quot;&amp;&amp;args(trackNumber)&amp;&amp;within(soundsystem.*)$$bean(sgtPeppers)&quot;)</span><span class="comment">//指定方法、获取参数（捕获目标方法的参数）、限定包路径、限定bean名称</span></span><br></pre></td></tr></table></figure></div>

<h3 id="通过切片扩展类的行为"><a href="#通过切片扩展类的行为" class="headerlink" title="通过切片扩展类的行为"></a>通过切片扩展类的行为</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncoreableIntroducer</span> &#123;</span><br><span class="line">    <span class="meta">@DeclareParents(value = &quot;concert.Performance+&quot;,//后面的+表示应用到所有实现了该接口的Bean</span></span><br><span class="line"><span class="meta">            defaultImpl = DefaultEncoreable.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Encoreable encoreable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> EncoreableIntroducer <span class="title function_">encoreableIntroducer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EncoreableIntroducer</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Encoreable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">performEncore</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultEncoreable</span> <span class="keyword">implements</span> <span class="title class_">Encoreable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performEncore</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;perform the encore!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;============DefaultEncoreable============&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Encoreable</span> <span class="variable">concert2</span> <span class="operator">=</span> ctx.getBean(<span class="string">&quot;concert2&quot;</span>, Encoreable.class);</span><br><span class="line">concert2.performEncore();</span><br></pre></td></tr></table></figure></div>

<h3 id="横切关注点"><a href="#横切关注点" class="headerlink" title="横切关注点"></a>横切关注点</h3><ul>
<li>日志</li>
<li>安全：比如用户权限的控制</li>
<li>事务：比如数据库事务</li>
<li>缓存：提升性能</li>
</ul>
<h3 id="在没有切片之前…"><a href="#在没有切片之前…" class="headerlink" title="在没有切片之前…"></a>在没有切片之前…</h3><p>委托（持有一个引用）、继承</p>
<h3 id="织入时机"><a href="#织入时机" class="headerlink" title="织入时机"></a>织入时机</h3><p>运行期：使用代理对象，只支持方法级别的切入</p>
<h2 id="MVC架构"><a href="#MVC架构" class="headerlink" title="MVC架构"></a>MVC架构</h2><h3 id="Web开发框架分层，请求是如何被处理的"><a href="#Web开发框架分层，请求是如何被处理的" class="headerlink" title="Web开发框架分层，请求是如何被处理的"></a>Web开发框架分层，请求是如何被处理的</h3><p>基本的层为 控制器层、业务逻辑层、数据访问层</p>
<ol>
<li>请求发到基本单元Severlet</li>
<li>Mapping组件根据url，将请求交给对应的控制器，同时解析参数</li>
<li>Controller拿到参数，校验后交给业务层</li>
<li>业务层进行业务处理，可能与数据访问层发生交互</li>
<li>业务层将处理结果交给Controller</li>
<li>Controller将结果交给Serverlet</li>
<li>Severlet寻找第三方渲染库，将数据和逻辑视图名交给之</li>
<li>第三方库渲染逻辑视图</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://files.lsmcloud.top/blog2c13892809b78734d5a1aab2786d45b9.png"
                     
                ></p>
<p>model-view-controller</p>
<p>模型：存储内容</p>
<p>控制器：处理</p>
<p>视图：显示内容</p>
<p>适用于前后端不分离的开发场景</p>
<h3 id="Data注解"><a href="#Data注解" class="headerlink" title="@Data注解"></a>@Data注解</h3><p>没有data注解时，我们要为每个属性写get方法和set方法</p>
<p>加了data，lombok会帮助我们生成这些方法</p>
<p>lombok仅在编译时生效，我们可以在pom中设置exclude，发行版中不加入lombok包</p>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><h4 id="RequestMapping-“-x2F-design”"><a href="#RequestMapping-“-x2F-design”" class="headerlink" title="@RequestMapping(“&#x2F;design”)"></a>@RequestMapping(“&#x2F;design”)</h4><p>让控制器处理以design为前缀的url</p>
<h4 id="Controller-1"><a href="#Controller-1" class="headerlink" title="@Controller"></a>@Controller</h4><p>告诉spring这是controller，效果上和@component一样</p>
<h4 id="GetMapping"><a href="#GetMapping" class="headerlink" title="@GetMapping"></a>@GetMapping</h4><p>get请求到这里处理</p>
<h5 id="请求的类别"><a href="#请求的类别" class="headerlink" title="请求的类别"></a>请求的类别</h5><ul>
<li>Get 获得资源</li>
<li>Post 创建资源</li>
<li>Put 更新资源</li>
<li>Delete 删除资源</li>
<li>Patch</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<p>这里返回的字符串是一个逻辑视图名，spring在resource&#x2F;template中找到模版，塞入数据后（渲染）出页面</p>
<h4 id="SessionAttributes-“Taco”"><a href="#SessionAttributes-“Taco”" class="headerlink" title="@SessionAttributes(“Taco”)"></a>@SessionAttributes(“Taco”)</h4><p>指定Taco是一个Session级别的属性，一次会话包含多次请求</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">processTaco</span><span class="params">(<span class="meta">@ModleAttribute</span> TacoOrder tacoOrder)</span>&#123; <span class="comment">//让这个方法获得Model里的数据</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;<span class="comment">//返回一个重定向请求到浏览器</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="Slf4j"><a href="#Slf4j" class="headerlink" title="@Slf4j"></a>@Slf4j</h4><p>定义一个log对象，让你打印log</p>
<h4 id="Valid"><a href="#Valid" class="headerlink" title="@Valid"></a>@Valid</h4><p>添加校验</p>
<h4 id="校验表单输入"><a href="#校验表单输入" class="headerlink" title="校验表单输入"></a>校验表单输入</h4><ol>
<li><p>领域类添加校验规则</p>
<p>属性上方添加一些注解</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="meta">@Size(min=1, message=&quot;You must choose at least 1 ingredient&quot;)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Ingredient&gt; ingredients;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>添加@Valid注解</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">processTaco</span><span class="params">(</span></span><br><span class="line"><span class="params">		  <span class="meta">@Valid</span> Taco taco, Errors errors,</span></span><br><span class="line"><span class="params">		  <span class="meta">@ModelAttribute</span> TacoOrder tacoOrder)</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>修改表单视图展示错误</p>
</li>
</ol>
<h4 id="WebConfig"><a href="#WebConfig" class="headerlink" title="WebConfig"></a>WebConfig</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">    registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="Spring-MVC获取参数的几种方式"><a href="#Spring-MVC获取参数的几种方式" class="headerlink" title="Spring MVC获取参数的几种方式"></a>Spring MVC获取参数的几种方式</h4><ul>
<li>form参数转成model，成员类型可能会用到Converter进行类型转换</li>
<li>路径参数 @Pathvariable</li>
<li>请求参数（查询参数）， </li>
<li>json请求体，@RequestBody，会用到HttpMessageConverter消息转换器，RestAPI</li>
</ul>
<h4 id="Spring-MVC的请求映射注解"><a href="#Spring-MVC的请求映射注解" class="headerlink" title="Spring MVC的请求映射注解"></a>Spring MVC的请求映射注解</h4><p>可以放在类上，也可以放在方法上</p>
<ul>
<li><p>@RequestMapping 可以再这个注解后面详细解释，是通用的</p>
</li>
<li><p>@GetMapping</p>
</li>
<li><p>@PostMapping</p>
</li>
<li><p>@PutMapping</p>
</li>
<li><p>@DeleteMapping</p>
</li>
<li><p>@PatchMapping</p>
</li>
</ul>
<h4 id="Model和View的关系"><a href="#Model和View的关系" class="headerlink" title="Model和View的关系"></a>Model和View的关系</h4><p>Model提供View的输入</p>
<p>Model属性会复制到Servlet Request属性中，给视图用于渲染页面</p>
<p>thymeleaf和spring mvc是解耦的</p>
<p>Spring MVC发现了thymeleaf，会自己帮你创建支持thymeleaf的bean</p>
<h4 id="处理表单提交"><a href="#处理表单提交" class="headerlink" title="处理表单提交"></a>处理表单提交</h4><h4 id="校验表单输入-1"><a href="#校验表单输入-1" class="headerlink" title="校验表单输入"></a>校验表单输入</h4><ul>
<li><p>javaBean Validation API</p>
</li>
<li><p>spring-boot-starter-validation（Hibernate针对javaBean Validation API的实现）</p>
</li>
<li><p>领域类加校验规则</p>
</li>
<li><p>控制器中声明校验</p>
</li>
<li><p>修改表单视图展现校验错误</p>
</li>
</ul>
<h4 id="WebMVConfigurer"><a href="#WebMVConfigurer" class="headerlink" title="WebMVConfigurer"></a>WebMVConfigurer</h4><p>可以做很多事</p>
<h2 id="服务端数据库开发"><a href="#服务端数据库开发" class="headerlink" title="服务端数据库开发"></a>服务端数据库开发</h2><h3 id="使用几大springboot数据库开发框架的基本流程"><a href="#使用几大springboot数据库开发框架的基本流程" class="headerlink" title="使用几大springboot数据库开发框架的基本流程"></a>使用几大springboot数据库开发框架的基本流程</h3><h4 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h4><ol>
<li>配置依赖</li>
<li>配置数据源</li>
<li>注入JdbcTemplate</li>
<li>为查询创建相应的Mapper</li>
<li>使用jdbcTemplate.update,query等执行操作</li>
</ol>
<h4 id="Spring-data"><a href="#Spring-data" class="headerlink" title="Spring data"></a>Spring data</h4><h4 id="JPA，比如Hibernate"><a href="#JPA，比如Hibernate" class="headerlink" title="JPA，比如Hibernate"></a>JPA，比如Hibernate</h4><ol>
<li>配置依赖</li>
<li>配置Entity实体类</li>
<li>创建继承或实现CurdRepository接口的数据库接口</li>
<li>注入这个数据库</li>
<li>使用默认提供的方法就可以做到增删改查了</li>
</ol>
<h4 id="三种实现方式的区别和相同点"><a href="#三种实现方式的区别和相同点" class="headerlink" title="三种实现方式的区别和相同点"></a>三种实现方式的区别和相同点</h4><ol>
<li>template和spring data都需要提供schema脚本，jpa不需要，根据java对象生成表结构</li>
<li>从实现来看，template需要我们自行实现接口，spring data和jpa在大多数情况下不用再实现</li>
<li>从领域对象来看，template领域对象不用加注解，而后两种需要</li>
<li>后两者都提供了Query，但JPA可以通过DSL语言实现灵活的query</li>
<li>关于id字段的处理，template需要主动获取新生成的id，第二种和第三种不用</li>
<li>spring data的持久化注解来自spring自行定义，JPA来自javax</li>
</ol>
<h3 id="数据库初始化的基本方式"><a href="#数据库初始化的基本方式" class="headerlink" title="数据库初始化的基本方式"></a>数据库初始化的基本方式</h3><ol>
<li>schema.sql表创建,data.sql数据初始化</li>
<li>程序预加载：commandlinerunner接口，applicationrunner</li>
</ol>
<h3 id="基本继承的接口"><a href="#基本继承的接口" class="headerlink" title="基本继承的接口"></a>基本继承的接口</h3><p>curdRepository</p>
<h3 id="数据库开发中基于接口交互的好处"><a href="#数据库开发中基于接口交互的好处" class="headerlink" title="数据库开发中基于接口交互的好处"></a>数据库开发中基于接口交互的好处</h3><ol>
<li>便于对数据库访问层和业务逻辑层的测试，可以使用Mock工具提供接口的实现</li>
<li>可以灵活的替换数据库的实现，而不用更改业务层代码</li>
</ol>
<p>Spring为数据库访问提供了抽象的简化</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br></pre></td></tr></table></figure></div>

<p>这个类会被spring框架自动注入</p>
<h3 id="SQLException"><a href="#SQLException" class="headerlink" title="SQLException"></a>SQLException</h3><ol>
<li>数据库连接中断</li>
<li>表不存在</li>
<li>SQL语法错误</li>
<li>…</li>
</ol>
<h3 id="JdbcTemplate-1"><a href="#JdbcTemplate-1" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h3><ol>
<li>xml中添加jdbc依赖</li>
<li>在xml中指定数据库类型（MySQL、H2、Postgresql…）</li>
<li>（H2）在resources里面写.sql文件</li>
<li>写@Repository</li>
</ol>
<h4 id="在业务层访问Repository"><a href="#在业务层访问Repository" class="headerlink" title="在业务层访问Repository"></a>在业务层访问Repository</h4><h4 id="JdbcOperations是JdbcTemplate实现的接口"><a href="#JdbcOperations是JdbcTemplate实现的接口" class="headerlink" title="JdbcOperations是JdbcTemplate实现的接口"></a>JdbcOperations是JdbcTemplate实现的接口</h4><h4 id="访问H2控制台"><a href="#访问H2控制台" class="headerlink" title="访问H2控制台"></a>访问H2控制台</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/h2-console</span><br></pre></td></tr></table></figure></div>

<p>添加devtools访问</p>
<h3 id="data-jdbc"><a href="#data-jdbc" class="headerlink" title="data-jdbc"></a>data-jdbc</h3><p>Spring Data项目</p>
<ul>
<li><p>只是定义而不需实现接口(spring 来实现)</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CurdRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IngredientRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Ingredient, String&gt; &#123; <span class="comment">//指明操作的对象和ID的类型</span></span><br><span class="line">  <span class="comment">// 如果我想要添加一个新的查询方法,动作+By+字段，这是“领域特定语言”</span></span><br><span class="line">  <span class="comment">// 如果要更具体</span></span><br><span class="line">  <span class="meta">@Query(&quot;Order o where o.deliveryCity = &#x27;New York&#x27;&quot;)</span> <span class="comment">//方法名就叫叭叭叭ba~</span></span><br><span class="line">  List&lt;TacoOrder&gt; <span class="title function_">findByDeliveryZip</span><span class="params">(String DeliveryZip)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>定义数据类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access=AccessLevel.PRIVATE,force=true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ingredient</span> <span class="keyword">implements</span> <span class="title class_">Persistable</span>&lt;String&gt; &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@NotNull</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>  注意命名规范！java驼峰与建库脚本下划线对应</p>
</li>
<li><p>根路径下添加创建表的脚本</p>
</li>
<li><p>接口注入到业务层或控制器</p>
</li>
<li><p>如果你需要启动时插入数据…</p>
<p>在Application入口类中建立一个内部类</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CommandLineRunner <span class="title function_">dataLoader</span><span class="params">(BoyRepository repo)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> args -&gt; &#123;</span><br><span class="line">    repo.deleteAll();</span><br><span class="line">    repo.save(<span class="keyword">new</span> <span class="title class_">Boy</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>此方法调用的时机是所有Bean创建完成后，Application最后启动前</p>
</li>
</ul>
<h3 id="Spring-Data-JPA"><a href="#Spring-Data-JPA" class="headerlink" title="Spring Data JPA"></a>Spring Data JPA</h3><ul>
<li>JPA：Java Persistence API</li>
<li>宗旨是为POJO提供持久化标准规范</li>
<li>JPQL是一种面向对象的查询语言（类似SQL）</li>
<li>依赖是data-jpa</li>
</ul>
<p>步骤</p>
<ul>
<li><p>接口和上面的是一模一样嘟</p>
</li>
<li><p>对应关系</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//比table更厉害的注解，不要你写表结构，来自javax.persistense</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ingredient</span>&#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Column(&quot;wow&quot;)</span></span><br><span class="line"> 	<span class="meta">@Size(min=5, message=&quot;lalala&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String cao;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToMany(cascade=CascadeType.ALL)</span> <span class="comment">//告诉spring表之间有关联,cascade意味着一旦order被删除，对应的Taco一起删除</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Taco&gt; tacos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>数据库初始化有三种方式</p>
<ul>
<li>Data.sql schema.sql文本文件初始化</li>
<li>CommandLineRunner接口或ApplicationRunner接口</li>
</ul>
<h3 id="使用非关系型数据库"><a href="#使用非关系型数据库" class="headerlink" title="使用非关系型数据库"></a>使用非关系型数据库</h3><p>添加依赖</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>使用mongoDB client（不推荐）</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="comment">//创建时如果不提供url默认访问27017</span></span><br><span class="line">  <span class="type">MongoClinet</span> <span class="variable">mongoClient</span> <span class="operator">=</span> MongoClient.create();</span><br><span class="line">  <span class="type">MongoDatabase</span> <span class="variable">mongoDatabase</span> <span class="operator">=</span> mongoClient.getDatabase(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">  MongoCollection&lt;Document&gt; collection = mongoDatabase.getCollection(<span class="string">&quot;mytable&quot;</span>);</span><br><span class="line">  collection.deleteMany(Filtrs.eq(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lyl&quot;</span>));</span><br><span class="line">  <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lyl&quot;</span>).append(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>).append(...);</span><br><span class="line">  collection.insertOne(document);</span><br><span class="line">  FindIterable&lt;Document&gt; collection = mongoDatabase.find();</span><br><span class="line">  MongoCursor&lt;Document&gt; mongoCurosr = </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>JPA自动配置 （推荐）</p>
<p>propertie</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.uri=mongodb://localhost:27017/test</span><br></pre></td></tr></table></figure></div>



<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> interface </span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Document</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacaOrder</span>&#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> List&lt;Taco&gt; Tacos; <span class="comment">//Taco没有独立放在一个Collection里面，所以不用@Document，也不用@Id</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>Nosql倾向于把能关联的数据都塞进去，这会造成严重的重复存储问题，这就引出一堆去除重复方法</p>
<p>MongoDB性能</p>
<p>10000条数据插入大概是10s</p>
<h3 id="Java-Faker-1"><a href="#Java-Faker-1" class="headerlink" title="Java Faker"></a>Java Faker</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fack</span><span class="params">()</span>&#123;</span><br><span class="line"> <span class="type">Faker</span> <span class="variable">faker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Facker</span>(Locale.CHINA);</span><br><span class="line"> <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> faker.addtess.streetAddress();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="使用Redis"><a href="#使用Redis" class="headerlink" title="使用Redis"></a>使用Redis</h3><p>Redis的主要用途是缓存，我们不那么关心它是否能持久化</p>
<p>存储的基本单位是key-value</p>
<ul>
<li>redis-server<ul>
<li>redis配置，redis.conf</li>
<li>默认端口号6379</li>
</ul>
</li>
<li>redis-cli，客户端程序</li>
</ul>
<p>redis启动后默认开16个数据库</p>
<p>插入key-value</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">set myname lyl</span><br><span class="line">get myname</span><br><span class="line">set counter 100</span><br><span class="line">incr counter</span><br><span class="line">incrby counter 50</span><br><span class="line">exists counter //查询是否有这个key</span><br><span class="line">del myname</span><br><span class="line">keys * //查看所有的key</span><br></pre></td></tr></table></figure></div>

<p>redis中可以给key设置生命时长</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expire counter 15 //15s后counter就寄了</span><br></pre></td></tr></table></figure></div>

<p>key-value中value可以有不同类型，包括String（注意 前面的counter也是String，不过你还是可以加加减减的）, List</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpush mylist 15 //往mylist里面（不存在新建）从右边加一个15</span><br><span class="line">lrange mylist 0 -1 //获得所有的元素</span><br><span class="line">rtop mylist //从右边弹出一个元素</span><br></pre></td></tr></table></figure></div>

<p>Hash类型</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hmset user name lyl age 10</span><br><span class="line">hgetall user</span><br><span class="line">hget user name</span><br></pre></td></tr></table></figure></div>

<p>set</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sadd myset 1 2 3</span><br><span class="line">smembers myset</span><br></pre></td></tr></table></figure></div>

<p>删除数据库</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flushdb //删掉当前数据库</span><br><span class="line">flushall //删掉所有数据库</span><br></pre></td></tr></table></figure></div>



<h4 id="Jedis-早期-与Lettuce-现在"><a href="#Jedis-早期-与Lettuce-现在" class="headerlink" title="Jedis(早期)与Lettuce(现在)"></a>Jedis(早期)与Lettuce(现在)</h4><ul>
<li><p>它们都是供spring连接到redis的客户端</p>
</li>
<li><p>RedisConnectionFactory接口，JedisConnectionFactory</p>
<p>Application</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="comment">// String对应key，Product可以简单理解为value（但严格并不是）</span></span><br><span class="line"><span class="keyword">public</span> RedisTemplate&lt;String,Product&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectFactory cf)</span>&#123;</span><br><span class="line">  RedisTemplate&lt;String, Product&gt; redis = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">  redis.setConnectionFactory(cf);</span><br><span class="line">  <span class="keyword">return</span> redis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>properties</p>
<div class="highlight-container" data-rel="Properties"><figure class="iseeu highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">...</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">product.setName(<span class="string">&quot;bababa&quot;</span>);</span><br><span class="line">product.setSku(<span class="string">&quot;978888&quot;</span>)</span><br><span class="line">redisTemplate.opsForVlaue().set(product.getSku(),product); <span class="comment">//这最后存的是String类型，相当于做了序列化，也就是java提供的Serializable，字节化也就能持久化了</span></span><br><span class="line"><span class="comment">//这个时候去redis里面看key的内容，只会看到一坨意义不明的东西，这是序列化后的字节序列，这是JDK自己的方式</span></span><br><span class="line"><span class="comment">//通过</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForList().rightPush(<span class="string">&quot;cart&quot;</span>,product1);</span><br><span class="line">redisTemplate.opsForList().rightPush(<span class="string">&quot;cart&quot;</span>,product2);</span><br><span class="line"><span class="type">Product</span> <span class="variable">first</span> <span class="operator">=</span> redisTemplate.leftPop(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">List&lt;Product&gt; products = redisTemplate.opForList().range(<span class="string">&quot;cart&quot;</span>,<span class="number">2</span>,<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redisTemplate.opForSet();</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果懒得老是指定&quot;cart&quot;这样的key</span></span><br><span class="line">BoudListOperations&lt;String,Product&gt; cart = redisTemplate.boundListOps(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//其实大家都喜欢用json格式串而不是jdk序列化</span></span><br><span class="line">redis.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">redis.setValueSerializer(<span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;Product&gt;(Product.class));</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果你想让redis忠实地返回数据库里的东西</span></span><br><span class="line">stringRedisTemplate = <span class="keyword">new</span> <span class="title class_">StringRedisTemplate</span>(cf);</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h2 id="目前用到的依赖"><a href="#目前用到的依赖" class="headerlink" title="目前用到的依赖"></a>目前用到的依赖</h2><h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><h3 id="权限控制原理-filter"><a href="#权限控制原理-filter" class="headerlink" title="权限控制原理 filter"></a>权限控制原理 filter</h3><p>请求处理之前会由一系列filter进行拦截处理</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://files.lsmcloud.top/blog3c245c2887378d5593064aa63641a4ee.png"
                     
                ></p>
<h3 id="开发实际操作中的步骤"><a href="#开发实际操作中的步骤" class="headerlink" title="开发实际操作中的步骤"></a>开发实际操作中的步骤</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://files.lsmcloud.top/blog5af7e7fd71225f69f0196780fc05f385.png"
                     
                ></p>
<ol>
<li>实现一个接口：UserDetailService</li>
<li>提供密码加解器</li>
<li>提供一个登录页面</li>
<li>使用y继承自HttpSecurity的SecurityFilterChain或WebSecurityAdapter进行权限处理</li>
</ol>
<p>框架帮我做的</p>
<ol>
<li>登录控制器的实现(Get,Post)</li>
<li>请求重定向到用户登录页面</li>
<li>通过Filter对设定的权限进行控制</li>
</ol>
<h3 id="用户信息的存储"><a href="#用户信息的存储" class="headerlink" title="用户信息的存储"></a>用户信息的存储</h3><ol>
<li>内存用户存储</li>
<li>JDBC数据库</li>
<li>LDAP目录数据库</li>
</ol>
<h3 id="权限分类"><a href="#权限分类" class="headerlink" title="权限分类"></a>权限分类</h3><h3 id="创建自定义登录页"><a href="#创建自定义登录页" class="headerlink" title="创建自定义登录页"></a>创建自定义登录页</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://files.lsmcloud.top/blogc14dc18bacd5773e444cd063b00785d1.png"
                     
                ></p>
<h3 id="Basic认证"><a href="#Basic认证" class="headerlink" title="Basic认证"></a>Basic认证</h3><h3 id="方法级的权限控制"><a href="#方法级的权限控制" class="headerlink" title="方法级的权限控制"></a>方法级的权限控制</h3><p>@PreAuthorize(“hasRolr(‘USER’)”) 实现就是基于AOP</p>
<p>jaas：jdk用户授权框架</p>
<p>添加依赖:spring-boot-starter-security</p>
<h3 id="在代码中获得当前登录的用户"><a href="#在代码中获得当前登录的用户" class="headerlink" title="在代码中获得当前登录的用户"></a>在代码中获得当前登录的用户</h3><ol>
<li>注入principle对象</li>
<li>或通过@AuthenticationPrincipal获取</li>
<li>通过安全上下文获取</li>
</ol>
<p><strong>密码转换器</strong></p>
<ul>
<li>NoPasswordEncoder CSDN倾情奉献</li>
<li>BCryptPasswordEncoder</li>
<li>…</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>配置spring-security</p>
<p>使用filter-chain</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">  <span class="comment">// 用户必须归属于USER角色才能访问design和orders，定义角色在User.java的覆写的getAuthorites中</span></span><br><span class="line">  <span class="keyword">return</span> http.authorizedRequest()</span><br><span class="line">    .mvmatchers(<span class="string">&quot;/design&quot;</span>,<span class="string">&quot;/orders&quot;</span>).hasRole(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">    .anyRequest().permitAll() <span class="comment">//注意这一条一定要放在最后，就像ACL的定义一样</span></span><br><span class="line">    </span><br><span class="line">    .and()</span><br><span class="line">    .formLogin()</span><br><span class="line">    .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    .userNameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    .and()</span><br><span class="line">    .logout()</span><br><span class="line">    .logoutSuccessfulUrl(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    .and()</span><br><span class="line">    .csrf() <span class="comment">// 配置csrf（跨站请求伪造）</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>使用webSecurityConfigAdapter</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> </span><br><span class="line"></span><br><span class="line">auth.inMemoryAuthentation()</span><br><span class="line">  .withUser(<span class="string">&quot;lyl&quot;</span>)</span><br><span class="line">  .password(<span class="string">&quot;***&quot;</span>)</span><br><span class="line">  .</span><br></pre></td></tr></table></figure></div>

<p>还可以对于业务层代码进行控制</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;)&quot;)</span> <span class="comment">//执行前检查</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAllOrders</span><span class="params">()</span>&#123;</span><br><span class="line">  orderRepository.deleteAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>背后的实现原理：就是面向切面编程，使用AOP技术</p>
<h3 id="CSRF-跨站请求伪造"><a href="#CSRF-跨站请求伪造" class="headerlink" title="CSRF 跨站请求伪造"></a>CSRF 跨站请求伪造</h3><p>攻击者利用用户通过验证的session id或cookie对服务器进行攻击，譬如site B提供一个表单并让浏览器提交以攻击 site A，为了避免这种情况，site A提供一个csrf字段进行校验，如果一个表单无法提供_csrf字段，那么就认为不满足csrf</p>
<p>为用户定义角色</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在声明实现UserDetails的数据类中覆写</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_USER&quot;</span>));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>

<p>与视图连接</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- end::thAction[] --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>Username: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>Password: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;logoutForm&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Logout&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h4 id="小寄巧：调整日志级别"><a href="#小寄巧：调整日志级别" class="headerlink" title="小寄巧：调整日志级别"></a>小寄巧：调整日志级别</h4><p>application.properties里面</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loggin.level.org.springframework.security=debug</span><br></pre></td></tr></table></figure></div>

<h3 id="解决csrf问题"><a href="#解决csrf问题" class="headerlink" title="解决csrf问题"></a>解决csrf问题</h3><p>记得在前端里面加上相应前端处理csrf的功能，比如thymeleaf就是th:action&#x3D;”@{&#x2F;add}”</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/add&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;contact&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div>



<h3 id="用户认证"><a href="#用户认证" class="headerlink" title="用户认证"></a>用户认证</h3><p>Security框架利用cookie验证用户,首次登录后服务端将提供set-cookie字段，这个字段将让浏览器在之后的请求时提供cookie，cookie中有session id，服务端用cookie和后端匹配后就可以保证登陆了</p>
<h3 id="用户授权"><a href="#用户授权" class="headerlink" title="用户授权"></a>用户授权</h3><h3 id="在开发中使用spring-security"><a href="#在开发中使用spring-security" class="headerlink" title="在开发中使用spring security"></a>在开发中使用spring security</h3><ol>
<li>实现一个接口：UserDetailService</li>
<li>提供PasswordEncoder</li>
<li>提供一个登录页面（如果不实现就会得到一个丑陋的页面）</li>
<li>调用HttpSecurity进行权限测试（可以通过继承webSecurityConfigurerAdapter，也可以通过bean FilterChain）</li>
</ol>
<p>spring security帮我们做了什么？</p>
<ol>
<li>实现用户登录控制器</li>
<li>请求重定向到用户登录页面</li>
<li>通过Filter对设定的权限进行控制</li>
</ol>
<p>用户信息存储</p>
<ul>
<li>内存用户存储</li>
<li>JDBC用户存储</li>
<li>LDAP用户存储（轻量级目录数据库）</li>
</ul>
<h3 id="HTTP-Basic认证，提交请求的同时同步提供用户名密码，测试的时候很方便"><a href="#HTTP-Basic认证，提交请求的同时同步提供用户名密码，测试的时候很方便" class="headerlink" title="HTTP Basic认证，提交请求的同时同步提供用户名密码，测试的时候很方便"></a>HTTP Basic认证，提交请求的同时同步提供用户名密码，测试的时候很方便</h3><p>可以让客户端在请求时带上一个Authorization请求头，带上加密的base64密码和用户名，这样服务端就不会重定向到登录页面了</p>
<p>启用basic</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">  .httpBasic()</span><br></pre></td></tr></table></figure></div>

<p>basic64不能用来加密，它很容易就会被破解，采用basic64为了将特殊字符转换成固定的64个字符，保证浏览器和后端可以兼容</p>
<h3 id="如果想要获得当前用户信息"><a href="#如果想要获得当前用户信息" class="headerlink" title="如果想要获得当前用户信息"></a>如果想要获得当前用户信息</h3><p>通过注入principle对象获取</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute(name=&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">user</span><span class="params">(Principal principal)</span>&#123;</span><br><span class="line">  String username=principal.getName();</span><br><span class="line">  User user=userRepo.findByUsername(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>想获得当前登录的用户对象</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/current&quot;)</span></span><br><span class="line">pubblic ...(<span class="meta">@AuthentationPrincipal</span> User user)&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>上下文获取</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User)authentication.getPrincipal();</span><br></pre></td></tr></table></figure></div>

<h2 id="配置属性"><a href="#配置属性" class="headerlink" title="配置属性"></a>配置属性</h2><h3 id="属性来源"><a href="#属性来源" class="headerlink" title="属性来源"></a>属性来源</h3><h4 id="途径一：application-yml-application-properties"><a href="#途径一：application-yml-application-properties" class="headerlink" title="途径一：application.yml application.properties"></a>途径一：application.yml application.properties</h4><div class="highlight-container" data-rel="Properties"><figure class="iseeu highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8090</span></span><br></pre></td></tr></table></figure></div>

<p>yaml</p>
<p>对象、键值对，使用冒号</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">animal:</span> <span class="string">pets</span></span><br><span class="line"><span class="attr">hash:</span> &#123;<span class="attr">name:</span> <span class="string">steve</span>, <span class="attr">foo:</span> <span class="string">bar</span>&#125;</span><br><span class="line"><span class="attr">animal:</span> [<span class="string">Dog</span>, <span class="string">cat</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="string">Cat</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Dog</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Goldfish</span></span><br></pre></td></tr></table></figure></div>

<h4 id="途径二：命令行参数"><a href="#途径二：命令行参数" class="headerlink" title="途径二：命令行参数"></a>途径二：命令行参数</h4><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ... --server.port=8090</span><br></pre></td></tr></table></figure></div>

<h4 id="途径三：java虚拟机参数"><a href="#途径三：java虚拟机参数" class="headerlink" title="途径三：java虚拟机参数"></a>途径三：java虚拟机参数</h4><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dserver.port=8081 -jar ...</span><br></pre></td></tr></table></figure></div>

<h4 id="途径四：操作系统环境变量"><a href="#途径四：操作系统环境变量" class="headerlink" title="途径四：操作系统环境变量"></a>途径四：操作系统环境变量</h4><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> SERVER_PORT=8082 <span class="comment">#windows</span></span><br><span class="line"><span class="built_in">export</span> SERVER_PORT=8082 <span class="comment">#Linux</span></span><br></pre></td></tr></table></figure></div>

<p>环境变量不支持’.’，所以用’_’，这样比较适合不同环境不同配置</p>
<h3 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h3><div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">datasource:</span></span><br><span class="line">		<span class="attr">driverClassName:</span> <span class="string">&quot;org.h2.Driver&quot;</span></span><br><span class="line">		<span class="attr">url:</span> <span class="string">&quot;jdbc:h2:mem:pornhub&quot;</span></span><br><span class="line">		<span class="attr">username:</span> <span class="string">sakiary</span></span><br><span class="line">		<span class="attr">password:</span> <span class="number">1788</span></span><br></pre></td></tr></table></figure></div>

<h3 id="Keytool"><a href="#Keytool" class="headerlink" title="Keytool"></a>Keytool</h3><ul>
<li>keytool是jdk自带的密钥库管理工具，位于%JAVA_HOME%\bin...</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -<span class="built_in">alias</span> lyl -keyalg RSA -storetype PKCS12 -storepass letmein -keystore mykeys.p12</span><br></pre></td></tr></table></figure></div>

<h3 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h3><p>根据文档内容生成指纹，这个指纹在不考虑极小概率的碰撞下可以标识这个文档，可以用于防止篡改和验证身份</p>
<h3 id="配置日志"><a href="#配置日志" class="headerlink" title="配置日志"></a>配置日志</h3><div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="attr">level:</span></span><br><span class="line">		<span class="attr">root:</span> <span class="string">WARN</span></span><br><span class="line">		<span class="attr">org.springframework.security:</span> <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure></div>

<h3 id="自定义属性的使用"><a href="#自定义属性的使用" class="headerlink" title="自定义属性的使用"></a>自定义属性的使用</h3><p>四个方案：</p>
<ol>
<li>通过@ConfigurerationPorperties(prefix&#x3D;’’)</li>
<li>通过@Value  @Value(“${com.sam.desc}”)</li>
<li>通过环境变量</li>
<li>通过程序参数</li>
</ol>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记得注入props</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">ordersForUser</span><span class="params">(</span></span><br><span class="line"><span class="params">  <span class="meta">@Authentication</span> User user, Model model</span></span><br><span class="line"><span class="params">)</span>&#123;</span><br><span class="line">  <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> Pageable.of(<span class="number">0</span>,props.getPageSize()); <span class="comment">//将数据分成n页，获得第0页的数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>yaml中定义</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">taco:</span></span><br><span class="line">	<span class="attr">orders:</span> <span class="number">22</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;toca.orders&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderProps</span>&#123;</span><br><span class="line">  <span class="meta">@Min(value=5, message=&quot;must be between 5 and 25&quot;)</span></span><br><span class="line">  <span class="meta">@Max(value=25, message=&quot;...&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>在属性文件中定义相对复杂的数据结构</p>
<p>key-value结构</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">discount:</span></span><br><span class="line">	<span class="attr">codes:</span></span><br><span class="line">		<span class="attr">a:</span> <span class="number">10</span></span><br><span class="line">		<span class="attr">b:</span> <span class="number">10</span></span><br><span class="line">		<span class="attr">c:</span> <span class="number">10</span></span><br><span class="line">		</span><br><span class="line"><span class="attr">boys:</span></span><br><span class="line">	<span class="attr">names:</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">Joy</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">Bob</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">Harry</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">Peter</span></span><br><span class="line">		<span class="bullet">-</span> <span class="string">Jim</span></span><br></pre></td></tr></table></figure></div>

<p>激活哪一个application.yml呢？</p>
<h3 id="激活profile"><a href="#激活profile" class="headerlink" title="激活profile"></a>激活profile</h3><p>假设有两个</p>
<p>application-ut.yml</p>
<p>application-st.yml</p>
<p>profile名分别是ut、st</p>
<ul>
<li>环境变量激活：spring_profiles_active&#x3D;st</li>
<li>命令行参数：java -jar … –spring.profile.active&#x3D;st</li>
<li>JVM系统属性：java -Dspring.profiles.active&#x3D;prod -jar …</li>
<li>使用注解创建@Profile</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile(&quot;!st&quot;)</span> <span class="comment">//不是st才生效,也可以对Bean生效</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DevelopmentConfig</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> commandLineRunner</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="Actuator"><a href="#Actuator" class="headerlink" title="Actuator"></a>Actuator</h3><p>暴露各种各样的端点（RESTapi url），要暴露多一些的话要include: “*”</p>
<p>提供获取当前程序信息的丰富的REASTapi</p>
<p>常用的一些端点</p>
<ul>
<li>&#x2F;actuator</li>
<li>&#x2F;actuator&#x2F;configprops</li>
<li>&#x2F;actuator&#x2F;health</li>
<li>&#x2F;actuator&#x2F;beans</li>
</ul>
<h3 id="分布式系统的配置数据来源"><a href="#分布式系统的配置数据来源" class="headerlink" title="分布式系统的配置数据来源"></a>分布式系统的配置数据来源</h3><h2 id="REST-API开发"><a href="#REST-API开发" class="headerlink" title="REST API开发"></a>REST API开发</h2><h3 id="ReST原则-Representation-State-Transfer"><a href="#ReST原则-Representation-State-Transfer" class="headerlink" title="ReST原则 Representation State Transfer"></a>ReST原则 Representation State Transfer</h3><ol>
<li>资源 网络上的一个实体，一般用url标识</li>
<li>表现层 Json Xml Html</li>
<li>状态转移 服务端-客户端</li>
<li>四个常用方法Get Post Put Delete</li>
</ol>
<h3 id="RestController（以及produces参数）-ResponeBody-RequestBody"><a href="#RestController（以及produces参数）-ResponeBody-RequestBody" class="headerlink" title="@RestController（以及produces参数） @ResponeBody @RequestBody"></a>@RestController（以及produces参数） @ResponeBody @RequestBody</h3><h3 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h3><ol>
<li>1xx：继续发啊</li>
<li>2xx：成功</li>
<li>3xx：重定向</li>
<li>4xx：非法</li>
<li>5xx：服务端寄了</li>
</ol>
<h3 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h3><ol>
<li>使用合适的Http动词</li>
<li>使用url来传达意义</li>
<li>使用json作为请求和返回的格式</li>
<li>使用状态码来传达结果含义</li>
</ol>
<h3 id="前端开发基础"><a href="#前端开发基础" class="headerlink" title="前端开发基础"></a>前端开发基础</h3><ul>
<li>HTML,CSS,JavaScript</li>
<li>Node.js是一个Javascript运行环境，让javascript可以开发后端</li>
<li>NPM 包管理工具</li>
<li>最著名的框架：Vue与React</li>
<li>前端开发常用架构MVVM</li>
<li>单文件组件：.vue 模版、逻辑、样式</li>
</ul>
<h3 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h3><p>Representation State Transfer 表现层状态转移，资源从服务端到客户端是一种转移，从客户端到服务端也是一种转移</p>
<p>如果一个架构符合Rest原则，则成为RESTful架构</p>
<p>spring多模块开发</p>
<p>根模块应当依赖子模块，构建时，spring从根模块开始分析模块间的依赖，最终从最基础的模块向根模块自下向上构建</p>
<p>开发一个RestController</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> <span class="comment">//将通过ResponseBody将返回值作为json格式串返回给客户端</span></span><br><span class="line"><span class="meta">@RequestMapping(path=&quot;/api/tacos&quot;,produces=&#123;&quot;application/json&quot;&#125;)</span><span class="comment">//告诉spring可以接受accept值为*/json的请求头</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins=&quot;http://tacacloud:8080&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacaController</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> TacoRepository tacoRepo;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">TacoController</span><span class="params">(TacoRepository tocaRepo)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.tacoRepo = tacoRepo;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@GetMapping(params=&quot;recent&quot;)</span> <span class="comment">//当请求中有recent参数时落到这个方法</span></span><br><span class="line">  <span class="comment">//spring借助了第三方包进行了java对象到json的转换</span></span><br><span class="line">  <span class="comment">//也可以用recentTacos(@RequestParam(value=&quot;recent&quot;) int recent)</span></span><br><span class="line">  <span class="comment">//路径参数可以用@PathVariable</span></span><br><span class="line">  <span class="keyword">public</span> Iterable&lt;Taco&gt; <span class="title function_">recentTacos</span><span class="params">()</span>&#123;</span><br><span class="line">    PageRuquest page=PageRequest.of(</span><br><span class="line">      <span class="number">0</span>,<span class="number">12</span>,sort.by(...));</span><br><span class="line">    <span class="keyword">return</span> tacoRepo.findAll(page).getContent();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PostMapping(comsumes=&quot;applications/json&quot;)</span></span><br><span class="line">  <span class="meta">@ResponseStatus(HttpStatus.CREATED)</span></span><br><span class="line">  <span class="comment">// RequestBody 告诉spring将请求体转为 Taco对象</span></span><br><span class="line">  <span class="keyword">public</span> Taco <span class="title function_">postTaco</span><span class="params">(<span class="meta">@RequestBody</span> Taco taco)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> tocaRepo.save(taco);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PutMapping(path=&quot;/&#123;orderId&#125;&quot;, comsumes=&quot;application/json&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> TacoOrder <span class="title function_">putOrder</span><span class="params">(<span class="meta">@PathVariable(&quot;orderId&quot;)</span> Long orderId, <span class="meta">@RequestBody</span> TacoOrder order)</span>&#123;</span><br><span class="line">    oder.setId();</span><br><span class="line">    tacoRepo.save();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PatchOrder()</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@DeletMapping()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="Http接口设计（必考）"><a href="#Http接口设计（必考）" class="headerlink" title="Http接口设计（必考）"></a>Http接口设计（必考）</h3><p>看ppt</p>
<h3 id="Spring-Starter-Rest"><a href="#Spring-Starter-Rest" class="headerlink" title="Spring Starter Rest"></a>Spring Starter Rest</h3><p>添加依赖</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>设置路径</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">data:</span></span><br><span class="line">		<span class="attr">rest:</span></span><br><span class="line">			<span class="attr">base-path:</span> <span class="string">/data-api</span></span><br></pre></td></tr></table></figure></div>

<p>还可以指定资源的名字</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@RestResource(rel=&quot;tacos&quot;, path=&quot;tacos&quot;)</span><br></pre></td></tr></table></figure></div>

<p>请求</p>
<p><code>http://tacacloud:8080/data-api/tacos?size=15&amp;page=2&amp;sort=createdAtdesc</code></p>
<p>客户端如何调用RestApi</p>
<p>使用restTemplate</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Ingredient <span class="title function_">getIngredientById</span><span class="params">(String ingredient)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> rest.getForObject(<span class="string">&quot;http&quot;</span>,Ingredient.class, IngredientId);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Ingredient <span class="title function_">getIngredientById2</span><span class="params">(String ingredient)</span>&#123;</span><br><span class="line">  ResponseEntity&lt;Ingredient&gt; resEntity =  rest.getForEntity(<span class="string">&quot;http&quot;</span>,Ingredient.class, IngredientId);</span><br><span class="line">  <span class="comment">//可以获得请求头部</span></span><br><span class="line">  logo.info(resEntity.getHead().getAccpt());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>使用Feign调用REST API</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;organizationservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrganizationFeginClient</span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">    methed = RequestMethod.GET,</span></span><br><span class="line"><span class="meta">    value = &quot;/home&quot;,</span></span><br><span class="line"><span class="meta">    consumes = &quot;application/json&quot;</span></span><br><span class="line"><span class="meta">  )</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>@RequestMapping用于请求映射</p>
<h3 id="响应头和响应体"><a href="#响应头和响应体" class="headerlink" title="响应头和响应体"></a>响应头和响应体</h3><ul>
<li>状态行</li>
<li>状态码：1已接收 2成功 3重定向 4有非法 5服务寄</li>
</ul>
<h2 id="分布式环境下RESTapi的权限控制-OAuth2"><a href="#分布式环境下RESTapi的权限控制-OAuth2" class="headerlink" title="分布式环境下RESTapi的权限控制-OAuth2"></a>分布式环境下RESTapi的权限控制-OAuth2</h2><h3 id="OAuth2的过程"><a href="#OAuth2的过程" class="headerlink" title="OAuth2的过程"></a>OAuth2的过程</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://files.lsmcloud.top/blog43636ac361ea1f337f6b6b3a4407fda0.png"
                     
                ></p>
<h3 id="OAuth2的图很可能考"><a href="#OAuth2的图很可能考" class="headerlink" title="OAuth2的图很可能考"></a>OAuth2的图很可能考</h3><p>为什么客户端要先拿到code，再用code去请求token？<br>添加依赖</p>
<h3 id="另外三种授权模式"><a href="#另外三种授权模式" class="headerlink" title="另外三种授权模式"></a>另外三种授权模式</h3><ol>
<li>隐式授权：授权服务器返回的不是Code，而是Token</li>
<li>用户凭证授权：直接用用户凭证向授权服务器索要令牌，而不是要用户登录</li>
<li>客户端授权：基于客户端特定的令牌授权</li>
</ol>
<h3 id="Auth服务器"><a href="#Auth服务器" class="headerlink" title="Auth服务器"></a>Auth服务器</h3><p>auth服务器和客户端都会有相同的redirect url配置，auth服务器的url是用来校验的，如果不一样，auth服务器会认为客户端要求的redirect url是恶意地址</p>
<h3 id="资源服务器"><a href="#资源服务器" class="headerlink" title="资源服务器"></a>资源服务器</h3><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>Security配置</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>在获得一个token后，客户端通过拦截器在每个请求上加上token</p>
<h2 id="消息中间件-ActiveMQ、RabbitMQ"><a href="#消息中间件-ActiveMQ、RabbitMQ" class="headerlink" title="消息中间件 ActiveMQ、RabbitMQ"></a>消息中间件 ActiveMQ、RabbitMQ</h2><h3 id="同步与异步"><a href="#同步与异步" class="headerlink" title="同步与异步"></a>同步与异步</h3><h3 id="消息中间件"><a href="#消息中间件" class="headerlink" title="消息中间件"></a>消息中间件</h3><ul>
<li><p>消息代理，作为消息接收的第三方，在生产者和消费者之间，这样两边都不必关心对方了</p>
</li>
<li><p>实现生产者和消费者的解耦</p>
</li>
</ul>
<p>常见的消息中间件</p>
<ul>
<li>ActiveMQ</li>
<li>RabbitMQ</li>
<li>kafka</li>
</ul>
<p>Postman &#x3D;&gt; Taco Cloud &#x3D;&gt; 消息中间件 &#x3D;&gt; Kitchen</p>
<h3 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h3><p>java消息服务，定义了java使用消息代理的通用API</p>
<p>spring有支持JMS的模版JmsTemplate</p>
<h4 id="重要概念"><a href="#重要概念" class="headerlink" title="重要概念"></a>重要概念</h4><ol>
<li>connectionfactory：到消息服务器的连接池</li>
<li>connection</li>
<li>session</li>
<li>destination </li>
<li>message</li>
</ol>
<h4 id="消息的序列化和反序列化：消息转换器"><a href="#消息的序列化和反序列化：消息转换器" class="headerlink" title="消息的序列化和反序列化：消息转换器"></a>消息的序列化和反序列化：消息转换器</h4><p>jackson2转为json最常用 </p>
<h4 id="两种接受消息的模式：拉取和推送"><a href="#两种接受消息的模式：拉取和推送" class="headerlink" title="两种接受消息的模式：拉取和推送"></a>两种接受消息的模式：拉取和推送</h4><p>Pull模式：消费者主动向消息中间件拉取消息 <code>(TacoOrder) JmsTemplate.receiveAndConvert(&quot;tacocloud.order.queue&quot;);</code></p>
<p>Push消息中间件主动将消息推送给消费者 </p>
<p><code>@JmsListener(destination = &quot;tacocloud.order.queue&quot;) public void receiveOrder(TacoOrder order) &#123; ui.displayOrder(order); &#125;</code></p>
<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><p>创建交换机和队列</p>
<h4 id="重要概念-1"><a href="#重要概念-1" class="headerlink" title="重要概念"></a>重要概念</h4><ol>
<li>ConnectionFactory Connection Channel</li>
<li>Exchange</li>
<li>Queue</li>
<li>Routing Key</li>
<li>Binding Key</li>
</ol>
<h3 id="ActiveMQ-Artemis"><a href="#ActiveMQ-Artemis" class="headerlink" title="ActiveMQ Artemis"></a>ActiveMQ Artemis</h3><p>支持协议</p>
<ul>
<li>JMS</li>
<li>AMQP 也是RabbitMQ支持的协议 </li>
<li>MQTT（物联网常用）</li>
</ul>
<p>支持Native内存模式 与 JVM模式</p>
<p>分布式架构，消息持久化</p>
<p>生产端</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>消费端</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">  <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActiveMQConnectionFavtory</span>(BROKE_URL,USERNAME);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="Taco-Cloud应用添加发消息功能"><a href="#Taco-Cloud应用添加发消息功能" class="headerlink" title="Taco Cloud应用添加发消息功能"></a>Taco Cloud应用添加发消息功能</h4><h5 id="生产侧"><a href="#生产侧" class="headerlink" title="生产侧"></a>生产侧</h5><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> interface</span><br></pre></td></tr></table></figure></div>

<p>获取第三方jar包源码：mvn dependency:sources</p>
<p>想把代码文档翻译的话就用Translation 插件</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JmsOrderMessaging</span>&#123;</span><br><span class="line">  <span class="meta">@AutoWired</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">JmsOrderMessaging</span><span class="params">(JmsTemplate jms)</span>&#123;</span><br><span class="line">    	<span class="built_in">this</span>.jms=jms;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendOrder</span><span class="params">(TacoOrder order)</span>&#123;</span><br><span class="line">    jms.convertAndSend(<span class="string">&quot;tacocloud.order.queue&quot;</span>, order, <span class="built_in">this</span>::addOrderSource);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>converter</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MappingJakson2MessageConverter <span class="title function_">messageCoverter</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="type">MappingJakson2MessageConveter</span> <span class="variable">messageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJacksonConverter</span>();</span><br><span class="line">  <span class="comment">// 告诉消费者把数据转成哪个类</span></span><br><span class="line">  messageConverter.setTypeIdPropertyName();</span><br><span class="line">  messageConverter.setTypeIdProperty(<span class="string">&quot;_typeid&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  Map&lt;String,Class&lt;?&gt;&gt; typeIdMappings = <span class="keyword">new</span> <span class="title class_">HashMap</span>(String, Class&lt;?&gt;);</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="消费侧"><a href="#消费侧" class="headerlink" title="消费侧"></a>消费侧</h5><p>取消息有两种方式：主动去哪或者artemis推送给你</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JmsOrderReceiver</span>(JmsTemplate jms)&#123;</span><br><span class="line">  <span class="keyword">private</span> JmsTemplate jmsTemplate;</span><br><span class="line">  <span class="meta">@AutoWired</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">JmsOrderReceiver</span><span class="params">(JmsTemplate jms)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.jmsTemplate=jms;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> receiveMessage</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="RabbitMQ-1"><a href="#RabbitMQ-1" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><ul>
<li><p>ConnectionFactory Connection Channel</p>
</li>
<li><p>Exchange: Default Direct Topic Fanout Headers DeadLetter</p>
<ul>
<li>Exchange根据Routing Key和Binding Key将消息分发到不同的Queue</li>
<li>Direct exchange根据key发送</li>
<li>Fanout exchange直接将消息广播给所有连接到它的Queue</li>
</ul>
</li>
<li><p>Queue</p>
</li>
<li><p>Routing Key</p>
<ul>
<li>Sender给消息指定Routing key</li>
</ul>
</li>
<li><p>Binding Key</p>
<ul>
<li>每个Queue有Binding key</li>
<li>Binding key是可以用通配符的</li>
</ul>
</li>
</ul>
<p>依赖</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>发送</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendOrder</span><span class="params">(TacaOrder order)</span>&#123;</span><br><span class="line">  rabbit.convertAndSend(<span class="string">&quot;tacocloud.order.queue&quot;</span>,order,);</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">sendOrder</span><span class="params">()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>消费方只需要关心队列的名字，什么key，exchange都是发送方才关心的事</p>
<h4 id="AMQP是一个消息协议"><a href="#AMQP是一个消息协议" class="headerlink" title="AMQP是一个消息协议"></a>AMQP是一个消息协议</h4><h2 id="Spring-Integration"><a href="#Spring-Integration" class="headerlink" title="Spring Integration"></a>Spring Integration</h2><h3 id="集成流-integration-flow"><a href="#集成流-integration-flow" class="headerlink" title="集成流 integration flow"></a>集成流 integration flow</h3><p><strong>集成流组件要重点了解</strong></p>
<h4 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h4><h4 id="集成流配置"><a href="#集成流配置" class="headerlink" title="集成流配置"></a>集成流配置</h4><ul>
<li>XML配置</li>
</ul>
<h4 id="转换器"><a href="#转换器" class="headerlink" title="转换器"></a>转换器</h4><p>进来的内容可以和出来的内容不一样</p>
<h4 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h4><h4 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h4><h4 id="切分器"><a href="#切分器" class="headerlink" title="切分器"></a>切分器</h4><p>一个消息分成多个消息</p>
<h4 id="服务激活器"><a href="#服务激活器" class="headerlink" title="服务激活器"></a>服务激活器</h4><p>消息进来后调用一个服务进行处理</p>
<p>使用MessageHandler会将消息消费掉</p>
<p>使用GenericHandler处理完消息后还会把消息丢到目标channel去</p>
<blockquote>
<p>转换器和服务激活器的区别？处理过程上二者没有区别，但是从业务上说，Transformer是为了对消息进行转换，服务激活器则是为了激活另一个服务（比如做一次存储，掉一个外部服务等等）</p>
</blockquote>
<h4 id="网关-1"><a href="#网关-1" class="headerlink" title="网关"></a>网关</h4><p>除了单向还有双向网关</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@MessagingGateway(defaultRequestChannel)</span></span><br></pre></td></tr></table></figure></div>

<h4 id="通道适配器"><a href="#通道适配器" class="headerlink" title="通道适配器"></a>通道适配器</h4><h2 id="反应式编程"><a href="#反应式编程" class="headerlink" title="反应式编程"></a>反应式编程</h2><h3 id="反应式编程解决的问题"><a href="#反应式编程解决的问题" class="headerlink" title="反应式编程解决的问题"></a>反应式编程解决的问题</h3><p>反应式编程面向IO密集型场景，</p>
<p>IO非常明显的一个特点就是会出现等待，当IO密集时，往往线程也很多，线程之间的切换需要比较大的开销，如果CPU要管理大量的线程，自然速度就会很慢，因为大量的时间都被用于线程的切换</p>
<p>为了解决这种问题，我们引入事件轮询机制，将原来的为每一个客户端提供服务的线程释放，现在客户端都统一通过发送request请求来加入一个事件队列，一个线程轮询事件队列来不断地处理</p>
<p>反应式编程是消费方驱动的，没有收到request，publisher是不会没事找事的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://files.lsmcloud.top/blogb9bb950582127d66fc231b1fe8bfd954.png"
                     
                ></p>
<h3 id="两种编程模式"><a href="#两种编程模式" class="headerlink" title="两种编程模式"></a>两种编程模式</h3><ul>
<li>命令式</li>
<li>反应式</li>
</ul>
<h3 id="Reactor"><a href="#Reactor" class="headerlink" title="Reactor"></a>Reactor</h3><h4 id="和java默认stream的区别"><a href="#和java默认stream的区别" class="headerlink" title="和java默认stream的区别"></a>和java默认stream的区别</h4><p>默认的是同步的，其实只是一种用函数来迭代处理集合的方式</p>
<h4 id="webflux"><a href="#webflux" class="headerlink" title="webflux"></a>webflux</h4><p>启用基于响应式编程的web应用程序的开发，提供类似Spring MVC的编程模型</p>
<h3 id="反应式流规范规定的四个接口"><a href="#反应式流规范规定的四个接口" class="headerlink" title="反应式流规范规定的四个接口"></a>反应式流规范规定的四个接口</h3><p>这里非常重要</p>
<ul>
<li>publisher：发布消息</li>
<li>processor：加工传递消息</li>
<li>subscriber：订阅消息</li>
<li>subscription：协调publisher和subscriber</li>
</ul>
<h3 id="Subscriber"><a href="#Subscriber" class="headerlink" title="Subscriber"></a>Subscriber</h3><p>注意b.subscribe(a)是a订阅b</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSubscribe</span><span class="params">(Flow.Subscription subscription)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.subscription=subscribtion;</span><br><span class="line">  <span class="built_in">this</span>.subscription.request(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到一条消息以后做什么</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onNext</span><span class="params">(T item)</span>&#123;</span><br><span class="line">  consumedElements.add(item);</span><br><span class="line">  <span class="built_in">this</span>.subscription.request(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="Publisher"><a href="#Publisher" class="headerlink" title="Publisher"></a>Publisher</h3><h3 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h3><p>回压</p>
<p>四类操作：创建、组合、</p>
<h3 id="reactor反应式流图"><a href="#reactor反应式流图" class="headerlink" title="reactor反应式流图"></a>reactor反应式流图</h3><p>Flux：包含0到N个元素的异步序列</p>
<p>Mono：包含0或者1个元素的异步序列正常的包含元素的</p>
<p>消息：序列结束的消息嗯序列出错的消息</p>
<p>操作符：对流上元素的操作</p>
<h3 id="Flux的合并"><a href="#Flux的合并" class="headerlink" title="Flux的合并"></a>Flux的合并</h3><ul>
<li>merge</li>
<li>zip（默认合并成元组，也可以合并成指定类型）</li>
<li>first 只取首先产生消息的流</li>
</ul>
<p>flatMap可以将一个流又转换成一个新的流，比如从一个Flux转为一个Mono（这样做可以让Mono跑在不同的线程里，形成多线程），可以用.subscribeOn(Schedulers.parallel())让流并行的跑</p>
<p>flatmap可以扁平化流</p>
<p>schedulers还有</p>
<ul>
<li>immediate</li>
<li>single</li>
<li>parallel</li>
</ul>
<p>map和flatmap的区别：（很重要）</p>
<h2 id="Spring-WebFlux"><a href="#Spring-WebFlux" class="headerlink" title="Spring WebFlux"></a>Spring WebFlux</h2><p>启用基于响应式编程的Web应用程序的开发，提供类似于Spring MVC的编程模型</p>
<p>目前讲的三类消息：</p>
<ul>
<li>反应式编程和Integration中的消息：在java虚拟机内，所以不用序列化</li>
<li>RabbitMQ等消息中间件的消息要在外部传输，需要序列化</li>
</ul>
<h3 id="Spring-MVC和Spring-WebFlux共性与不同"><a href="#Spring-MVC和Spring-WebFlux共性与不同" class="headerlink" title="Spring MVC和Spring WebFlux共性与不同"></a>Spring MVC和Spring WebFlux共性与不同</h3><ul>
<li>MVC底层是Servlet，基于Servlet API</li>
<li>WebFlux底层是Netty，基于Reactive HTTP</li>
<li>WebFlux通过Router Function实现请求处理</li>
</ul>
<p>block和blocklast会阻塞调用它们的线程直到拿到结果，用subscribe的话结果可能就拿不到了</p>
<h3 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h3><p>reactive.ReactiveCrudRepositoy</p>
<h3 id="基于函数式编程的请求处理"><a href="#基于函数式编程的请求处理" class="headerlink" title="基于函数式编程的请求处理"></a>基于函数式编程的请求处理</h3><ul>
<li>使用函数式编程风格定义endpoints</li>
<li>两个基本组件HandlerFunction RouterFunction</li>
</ul>
<p>webclient: 对应resTemplate</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RouterFunction&lt;?&gt;()&#123;</span><br><span class="line">  <span class="keyword">return</span> route(GET(<span class="string">&quot;/hello&quot;</span>), request -&gt; ok().body(just(<span class="string">&quot;Hello World&quot;</span>), String.class))</span><br><span class="line">    .andRoute(GET(<span class="string">&quot;/bye&quot;</span>).and(accept(MediaType.APPLICATION_JSON)), greetingHandler::hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>反应式编程测试webTestClient</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webTestClient.get().uri(...).accept(MediaType.APPLICATION_JSON).exchange().expectStatus().isOk().expectHeader().contentType(MediaType.APPLICATION_JSON).expectBody(Greeting.Class)</span><br></pre></td></tr></table></figure></div>

<h2 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h2><h2 id="docker镜像构建与服务编排"><a href="#docker镜像构建与服务编排" class="headerlink" title="docker镜像构建与服务编排"></a>docker镜像构建与服务编排</h2><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t mysite:latest . </span><br></pre></td></tr></table></figure></div>

<p>其中.是构建上下文</p>
<h4 id="编写dockerfile之最佳实践"><a href="#编写dockerfile之最佳实践" class="headerlink" title="编写dockerfile之最佳实践"></a>编写dockerfile之最佳实践</h4><p>.dockerignore: 拷贝文件时不要拷贝这些文件</p>
<p>容器只运行单个应用</p>
<p>多个run指令合并为一个，不然你会整出一堆层来</p>
<p>基础镜像标签不要用latest，不然可能出现兼容问题</p>
<p>每个run指令执行后立刻删除多余文件，不然即使下一层删除也仅仅只是本层不可见而已</p>
<p>采用精简版本的镜像，比如Buster、Alpine</p>
<p>设置WORKDIR和CMD，不然它会重用基础镜像的CMD，还可以采用EntryPoint结合CMD来灵活的决定运行哪一个分支</p>
<p>合理的调整指令的顺序，改动少的要放到前面，这样可以充分利用缓存</p>
<p>添加HEALTHCHECK，比使用–restart always更厉害，可以让docker daemon在一些条件下重启容器</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> CMD curl --fail http://localhost:<span class="variable">$APP_PORT</span> || <span class="built_in">exit</span> 1</span></span><br><span class="line"><span class="comment"># 让daemon定时访问指定url，如果失败返回1，此时daemon会重启容器</span></span><br></pre></td></tr></table></figure></div>

<h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><p>docker-compose.yml 希望指定部署哪些服务</p>
<p>使用缩进表示层级关系</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>John Doe</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://blog.lsmcloud.top/2023/09/07/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/">http://blog.lsmcloud.top/2023/09/07/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/"># 课程笔记</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2023/09/08/%E7%A7%BB%E5%8A%A8%E4%BA%92%E8%81%94%E7%BD%91%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">移动互联网软件工程</a>
            
            
            <a class="next" rel="next" href="/2023/09/07/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/">软件测试</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© John Doe | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>